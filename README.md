# Cinema Board

Табло расписания кинотеатра для 5 мониторов (9600×1080).

## Технологии

- **Frontend**: Vue 3 + Vite + TypeScript
- **Backend**: Node.js + Fastify + TypeScript
- **База данных**: SQLite

## Структура проекта

```
cinema-board/
├── backend/          # Backend сервер (Fastify)
├── frontend/         # Frontend приложение (Vue 3)
├── package.json      # Корневой package.json для monorepo
└── README.md
```

## Установка

### Требования

- Node.js LTS (версия 18 или выше)
- npm

### Шаги установки

1. Установите зависимости для всех частей проекта:

```bash
npm run install:all
```

Или вручную:

```bash
npm install
cd backend && npm install && cd ..
cd frontend && npm install && cd ..
```

## Запуск

### Режим разработки

Запускает backend и frontend параллельно:

```bash
npm run dev
```

- Backend: http://localhost:8080
- Frontend: http://localhost:5173

### Production сборка

1. Соберите проект:

```bash
npm run build
```

2. Запустите сервер:

```bash
npm run start
```

Сервер будет доступен на http://localhost:8080

### Запуск табло в полноэкранном режиме

1. Соберите проект: `npm run build`
2. Запустите сервер: `npm run start`
3. Откройте браузер на http://localhost:8080/board
4. Нажмите F11 для полноэкранного режима

Или используйте скрипт `scripts/start-kiosk.bat` (см. ниже).

## Использование

### Табло

- URL: http://localhost:8080/board
- Публичная страница, не требует авторизации
- Автоматически обновляется каждые 30 секунд
- Отображает расписание на текущую дату
- Подсвечивает текущий и ближайший сеансы

### Админ-панель

- URL: http://localhost:8080/admin
- Требует авторизации
- Логин по умолчанию: `admin`
- Пароль по умолчанию: `admin`

**Внимание**: В продакшене обязательно измените пароль!

#### Возможности админки:

1. **Управление фильмами**
   - Добавление, редактирование, удаление фильмов
   - Настройка длительности, возрастного рейтинга, формата
   - Активация/деактивация фильмов

2. **Управление сеансами**
   - Добавление, редактирование, удаление сеансов
   - Фильтрация по дате и залу
   - Автоматическая проверка конфликтов (пересечение сеансов)
   - Автоматический расчёт времени окончания

3. **Управление залами**
   - Редактирование названий залов
   - Настройка порядка отображения

## База данных

База данных SQLite создаётся автоматически при первом запуске в папке `backend/data/cinema.db`.

### Инициализация

При первом запуске автоматически создаются:
- 5 залов (Зал 1, Зал 2, ..., Зал 5)
- Пользователь-администратор (логин: `admin`, пароль: `admin`)

### Структура БД

- **halls**: залы кинотеатра (1-5)
- **films**: фильмы
- **showtimes**: сеансы
- **users**: пользователи админки
- **sessions**: сессии авторизации

## API Endpoints

### Публичные

- `GET /api/board?date=YYYY-MM-DD` - данные для табло

### Авторизация

- `POST /api/auth/login` - вход
- `POST /api/auth/logout` - выход
- `GET /api/me` - текущий пользователь

### Админка (требуют авторизации)

- `GET /api/admin/films` - список фильмов
- `POST /api/admin/films` - создать фильм
- `PUT /api/admin/films/:id` - обновить фильм
- `DELETE /api/admin/films/:id` - удалить фильм

- `GET /api/admin/showtimes?date=YYYY-MM-DD&hallId=N` - список сеансов
- `POST /api/admin/showtimes` - создать сеанс
- `PUT /api/admin/showtimes/:id` - обновить сеанс
- `DELETE /api/admin/showtimes/:id` - удалить сеанс

- `GET /api/admin/halls` - список залов
- `PUT /api/admin/halls/:id` - обновить зал

## Валидация конфликтов

При сохранении сеанса автоматически проверяется:
- Нет ли пересечений с другими сеансами в том же зале
- Время начала и окончания не должны пересекаться

При обнаружении конфликта возвращается ошибка 409 с описанием.

## Особенности табло

- Фиксированный размер: 9600×1080 пикселей
- Автоматическое масштабирование под размер окна
- 5 колонок (по одному залу)
- Крупные часы и дата в шапке
- Подсветка текущего сеанса (синий)
- Подсветка ближайшего следующего сеанса (жёлтый)
- Нижняя строка с бегущей строкой (ticker)

## Скрипты

- `npm run dev` - запуск в режиме разработки
- `npm run build` - сборка для production
- `npm run start` - запуск production сервера
- `npm run install:all` - установка всех зависимостей

## Kiosk режим (Windows)

Скрипт `scripts/start-kiosk.bat` автоматически:
1. Запускает сервер
2. Открывает Chrome в kiosk режиме на странице табло

**Использование:**
```bash
scripts\start-kiosk.bat
```

**Примечание**: Скрипт пытается найти Chrome в стандартных местах. Если Chrome не найден, откроется обычный браузер по умолчанию.

## Безопасность

⚠️ **Важно для продакшена:**

1. Измените пароль администратора в БД
2. Используйте HTTPS
3. Настройте `secure: true` для cookies в `backend/src/routes/auth.ts`
4. Используйте bcrypt для хеширования паролей
5. Настройте CORS для конкретных доменов

## Разработка

### Структура backend

```
backend/
├── src/
│   ├── index.ts      # Точка входа
│   ├── db.ts         # Инициализация БД
│   ├── auth.ts       # Авторизация
│   ├── types.ts      # TypeScript типы
│   └── routes/       # API роуты
│       ├── auth.ts
│       ├── admin.ts
│       └── board.ts
└── data/             # SQLite база данных
```

### Структура frontend

```
frontend/
├── src/
│   ├── main.ts       # Точка входа
│   ├── App.vue       # Корневой компонент
│   ├── router/       # Vue Router
│   ├── views/        # Страницы
│   ├── api/          # API клиенты
│   └── style.css     # Глобальные стили
└── dist/             # Собранные файлы (после build)
```

## Лицензия

MIT
